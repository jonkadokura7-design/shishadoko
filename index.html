<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シーシャどこ？ | Shisha Doko</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --primary: #fbbf24;
            /* Amber 400 */
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #1a1025;
            /* Deep purple bg */
            color: #f3f4f6;
            min-height: 100vh;
            background-image: url('./public/shisha-bg.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            overflow-x: hidden;
        }

        /* Dark Overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 10, 25, 0.85);
            z-index: -1;
        }

        /* Glassmorphism */
        .glass-card {
            background: rgba(40, 30, 60, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 215, 0, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* Typography */
        .text-gold-gradient {
            background: linear-gradient(to right, #fde68a, #fbbf24, #d97706);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Glow Button */
        .glow-btn {
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            transition: all 0.3s ease;
        }

        .glow-btn:hover {
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.7);
            transform: translateY(-2px);
        }

        /* Smoke Animation Support */
        @keyframes drift {
            0% {
                transform: translateY(0) scale(0.5) translateX(-50%);
                opacity: 0;
            }

            50% {
                opacity: 0.4;
            }

            100% {
                transform: translateY(-100px) scale(2) translateX(-20%);
                opacity: 0;
            }
        }

        .smoke-particle {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 50px;
            height: 50px;
            background: rgba(128, 128, 128, 0.3);
            border-radius: 50%;
            filter: blur(20px);
            animation: drift 3s infinite ease-in-out;
            pointer-events: none;
        }
    </style>
</head>

<body class="flex flex-col items-center justify-center p-4">

    <!-- Screen 1: Landing -->
    <div id="landing-screen"
        class="flex flex-col items-center justify-center w-full max-w-lg transition-opacity duration-500">
        <div class="mb-8 text-center space-y-4">
            <!-- Decorative BG Elements -->
            <div
                class="fixed top-[-10%] left-[-10%] w-[50vh] h-[50vh] bg-purple-900/20 rounded-full blur-[100px] pointer-events-none">
            </div>

            <h1 class="text-5xl md:text-7xl font-bold tracking-tighter text-gold-gradient drop-shadow-lg pb-2">
                シーシャどこ？
            </h1>
            <p class="text-lg text-gray-400 font-medium tracking-wide">
                現在地から、最高のシーシャ体験を。
            </p>
        </div>

        <button onclick="startSearch()"
            class="group relative inline-flex h-14 w-64 items-center justify-center overflow-hidden rounded-full bg-amber-500 px-6 font-medium text-neutral-950 transition-all duration-300 hover:scale-105 hover:bg-amber-400 focus:outline-none glow-btn">
            <i data-lucide="map-pin" class="mr-2 h-5 w-5"></i>
            <span class="tracking-wider text-lg">今すぐ探す</span>
        </button>

        <div class="flex gap-4 text-sm text-gray-500 mt-12">
            <div class="flex items-center gap-1">
                <i data-lucide="sparkles" class="w-4 h-4 text-amber-500"></i>
                <span>★3.5以上の高評価</span>
            </div>
            <div class="flex items-center gap-1">
                <i data-lucide="clock" class="w-4 h-4 text-amber-500"></i>
                <span>現在地から1km圏内</span>
            </div>
        </div>
    </div>

    <!-- Screen 2: Loading (Hidden by default) -->
    <div id="loading-screen" class="hidden flex-col items-center justify-center w-full h-64">
        <div class="relative h-64 w-full flex justify-center items-end">
            <div class="smoke-particle" style="animation-delay: 0s;"></div>
            <div class="smoke-particle" style="animation-delay: 1s;"></div>
            <div class="smoke-particle" style="animation-delay: 2s;"></div>

            <!-- Shisha Base Icon Placeholder -->
            <div
                class="w-8 h-12 border-2 border-amber-500/50 rounded-b-xl relative z-10 bg-slate-900/50 backdrop-blur-sm mb-12">
                <div class="absolute bottom-0 w-full h-1/2 bg-amber-500/20 rounded-b-lg animate-pulse"></div>
            </div>
        </div>
        <p class="text-amber-200/80 font-light tracking-widest text-sm animate-pulse mt-4">検索中...</p>
    </div>

    <!-- Screen 3: Results (Hidden by default) -->
    <div id="results-screen" class="hidden w-full max-w-xl pb-20">
        <div class="flex items-center mb-6 pt-4">
            <button onclick="goBack()" class="mr-4 p-2 rounded-full hover:bg-white/10 transition-colors">
                <i data-lucide="arrow-left" class="w-6 h-6 text-amber-500"></i>
            </button>
            <h1 class="text-2xl font-bold text-gold-gradient">近くのシーシャ屋</h1>
        </div>

        <div id="results-container" class="space-y-4">
            <!-- Cards will be injected here -->
        </div>

        <div id="error-message" class="hidden text-center py-8 text-red-400">
            <p>位置情報を取得できませんでした。</p>
            <button onclick="startSearch()" class="mt-4 underline">再試行</button>
        </div>
    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // --- Mock Data ---
        const MOCK_PLACES = [
            {
                id: 'mock-1',
                name: 'シーシャカフェ＆バー MOCK',
                rating: 4.8,
                reviews: 120,
                address: '東京都渋谷区',
                isOpen: true,
                topReview: '渋谷で一番美味しいシーシャ！雰囲気が最高で店員さんもフレンドリーです。'
            },
            {
                id: 'mock-2',
                name: 'Hookah Lounge 霧 (MIST)',
                rating: 4.5,
                reviews: 85,
                address: '東京都新宿区',
                isOpen: true,
                topReview: 'フレーバーの種類が豊富。週末は少し混んでるけど行く価値あり。'
            },
            {
                id: 'mock-3',
                name: 'Desert Smoke 六本木',
                rating: 4.2,
                reviews: 50,
                address: '東京都港区六本木',
                isOpen: false,
                topReview: '六本木の隠れ家。作業やリラックスに最適でとても落ち着く。'
            },
            {
                id: 'mock-4',
                name: 'Blue Mist 秋葉原',
                rating: 3.9,
                reviews: 210,
                address: '東京都千代田区秋葉原',
                isOpen: true,
                topReview: 'コスパが良くて美味しい。グループで行くのに良い。'
            },
            {
                id: 'mock-5',
                name: 'Sultan\'s Oasis 銀座',
                rating: 4.7,
                reviews: 32,
                address: '東京都中央区銀座',
                isOpen: true,
                topReview: 'ラグジュアリーな体験。内装が本格的な中東スタイルで素晴らしい。'
            }
        ];

        // --- Logic ---
        function startSearch() {
            showScreen('loading-screen');

            if (!navigator.geolocation) {
                showError("お使いのブラウザは位置情報をサポートしていません。");
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    // Success: normally we'd call API here. 
                    // Simulating API delay and returning mock data.
                    setTimeout(() => {
                        renderResults(MOCK_PLACES);
                        showScreen('results-screen');
                    }, 2000);
                },
                (error) => {
                    // Error: Fallback to mock data anyway for demo purposes (or show error)
                    console.warn("Location failed, showing mock data:", error);
                    setTimeout(() => {
                        renderResults(MOCK_PLACES);
                        showScreen('results-screen');
                    }, 2000);
                }
            );
        }

        function renderResults(places) {
            const container = document.getElementById('results-container');
            container.innerHTML = '';

            if (places.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500">お店が見つかりませんでした。</p>';
                return;
            }

            places.forEach(place => {
                const card = document.createElement('div');
                card.className = 'glass-card rounded-xl p-6 mb-4 transform transition-all hover:scale-[1.02] hover:bg-white/5 border border-white/10 group animate-fade-in';

                // Star generation
                const fullStars = Math.floor(place.rating);
                let starsHtml = '';
                for (let i = 0; i < fullStars; i++) starsHtml += '<i data-lucide="star" class="w-4 h-4 fill-amber-400 text-amber-400 inline"></i>';
                if (place.rating % 1 !== 0) starsHtml += '<i data-lucide="star-half" class="w-4 h-4 fill-amber-400 text-amber-400 inline"></i>';

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-100 to-amber-400 group-hover:from-amber-200 group-hover:to-amber-500">
                            ${place.name}
                        </h3>
                        <span class="text-xs px-2 py-1 rounded-full border ${place.isOpen ? 'border-green-500/50 text-green-400 bg-green-900/20' : 'border-red-500/50 text-red-400 bg-red-900/20'}">
                            ${place.isOpen ? '営業中' : '営業時間外'}
                        </span>
                    </div>

                    <div class="flex items-center gap-2 mb-3">
                        <div class="flex items-center">${starsHtml}</div>
                        <span class="text-sm font-medium text-amber-200">${place.rating}</span>
                        <span class="text-xs text-gray-500">(${place.reviews}件)</span>
                    </div>

                    <div class="flex items-start gap-2 text-sm text-gray-300 mb-4">
                        <i data-lucide="map-pin" class="w-4 h-4 mt-0.5 text-amber-500 flex-shrink-0"></i>
                        <span>${place.address}</span>
                    </div>

                    <div class="bg-black/20 rounded-lg p-3 text-sm italic text-gray-400 border-l-2 border-amber-500">
                        <i data-lucide="message-square" class="w-3 h-3 inline mr-2 text-amber-500/70"></i>
                        "${place.topReview}"
                    </div>
                `;
                container.appendChild(card);
            });

            // Re-run icons for new elements
            lucide.createIcons();
        }

        function showScreen(screenId) {
            ['landing-screen', 'loading-screen', 'results-screen'].forEach(id => {
                const el = document.getElementById(id);
                if (id === screenId) {
                    el.classList.remove('hidden');
                    el.classList.add('flex');
                    if (id === 'results-screen') {
                        el.classList.remove('flex'); // Results is block usually
                    }
                } else {
                    el.classList.add('hidden');
                    el.classList.remove('flex');
                }
            });
        }

        function goBack() {
            showScreen('landing-screen');
        }

        function showError(msg) {
            const loading = document.getElementById('loading-screen');
            loading.classList.add('hidden');
            alert(msg);
            showScreen('landing-screen');
        }

    </script>
</body>

</html>